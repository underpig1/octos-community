!function(e,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s((e="undefined"!=typeof globalThis?globalThis:e||self).octos={})}(this,function(e){"use strict";class s{constructor(){this._listeners={},this._pendingRequests=new Map,this._init()}_init(){window.chrome?.webview?window.chrome.webview.addEventListener("message",e=>{this._handleWebviewMessage(e.data)}):console.warn(`[Octos] Failed to initialize, could not attach to a WebView2 instance. ${this.constructor.name} requires a WebView2 environment.`)}_on(e,s){const t=!this._listeners[e]||0===this._listeners[e].length;this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(s),t&&this._subscribe(e)}_once(e,s){const t=i=>{this._off(e,t),s(i)};this.on(e,t)}_off(e,s){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(e=>e!==s),0===this._listeners[e].length&&this._unsubscribe(e))}_emit(e,s){if(this._listeners[e])for(const t of this._listeners[e])t(s)}_handleWebviewMessage(e){if(e&&"string"==typeof e.type){if("response"===e.type&&e.requestId){const s=this._pendingRequests.get(e.requestId);return void(s&&(s.resolve(e.data),this._pendingRequests.delete(e.requestId)))}"event"==e.type&&"function"==typeof this._handleReceiveEvent?this._handleReceiveEvent(e):e.type in this._listeners&&this._emit(e.type,e.data)}}_request(e,s={}){return new Promise((t,i)=>{const n=crypto.randomUUID?.()||Math.random().toString(36).slice(2);this._pendingRequests.set(n,{resolve:t,reject:i});try{window.chrome?.webview?.postMessage({type:"request",requestType:e,requestId:n,data:s})}catch(e){this._pendingRequests.delete(n),i(e)}})}_command(e,s){window.chrome?.webview?.postMessage({type:"command",commandType:e,data:s})}_subscribe(e){window.chrome?.webview?.postMessage({type:"subscribe",eventType:e})}_unsubscribe(e){window.chrome?.webview?.postMessage({type:"unsubscribe",eventType:e})}}e.MediaController=class extends s{constructor(){super()}_handleReceiveEvent(e){switch(e.eventType){case"mediaChange":this._emit("mediaChange",e.data);break;case"playbackChange":this._emit("playbackChange",e.data);break;case"timelineChange":this._emit("timelineChange",e.data);break;case"audioStream":this._emit("audioStream",e.data)}}on(e,s){super._on(e,s)}once(e,s){super._once(e,s)}off(e,s){super._off(e,s)}async requestMediaProperties(){return super._request("media-props")}async requestPlaybackInfo(){return super._request("playback-info")}async requestTimelineProperties(){return super._request("timeline-props")}async requestThumbnail(){return super._request("thumbnail")}play(){return super._command("media",{cmd:"play"})}pause(){return super._command("media",{cmd:"pause"})}stop(){return super._command("media",{cmd:"stop"})}togglePlayPause(){return super._command("media",{cmd:"toggle"})}skipNext(){return super._command("media",{cmd:"next"})}skipPrevious(){return super._command("media",{cmd:"previous"})}setShuffle(e=!0){e?super._command("media",{cmd:"enable-shuffle"}):super._command("media",{cmd:"disable-shuffle"})}setRepeatMode(e){switch(e){case"track":super._command("media",{cmd:"set-repeat-track"});break;case"list":super._command("media",{cmd:"set-repeat-list"});break;case"none":super._command("media",{cmd:"set-repeat-none"})}}setSeekPosition(e){if(!Number.isInteger(e))throw new TypeError("Expected an integer");super._command("media",{cmd:"set-playback-position",position:e})}},e.MonitorBridge=class extends s{constructor(){super()}_handleReceiveEvent(e){if(e.data&&"redirect"===e.eventType)this._emit("message",{senderId:e.data["sender-id"],data:e.data.message})}async requestId(){return super._request("monitor-id")}async requestSiblingIds(){return super._request("siblings")}send(e,s){super._command("redirect",{"receiver-id":e,message:s})}on(e,s){super._on(e,s)}once(e,s){super._once(e,s)}off(e,s){this._off(e,s)}},e.System=class extends s{constructor(){super()}enableDevTools(){super._command("open-dev-tools")}async getSource(){return super._request("source")}async getTheme(){return await super._request("is-theme-light")?"light":"dark"}setVisibility(e){if(!0===e)super._command("set-visible");else{if(!1!==e)throw TypeError("Expected boolean");super._command("set-hidden")}}async getVisibility(){return super._request("visibility")}setDesktopIconVisibility(e){if(!0===e)super._command("set-desktop-icons-visible");else{if(!1!==e)throw TypeError("Expected boolean");super._command("set-desktop-icons-hidden")}}async getDesktopIconVisibility(){return super._request("desktop-icons-visibility")}},e.UserOptions=class extends s{constructor(){super()}_handleReceiveEvent(e){switch(e.eventType){case"options-change":var{id:s,value:t}=e.data;this._emit("change",{id:s,value:t});break;case"options-load":var{id:s,value:t}=e.data;this._emit("load",{id:s,value:t})}}on(e,s){super._on(e,s)}once(e,s){super._once(e,s)}off(e,s){this._off(e,s)}async requestOptions(){return super._request("options")}setOption(e,s){super._command("set-option",{id:e,value:s})}}});
